{% extends 'frontend/base.html' %}
{% load static i18n %}
{% get_current_language as LANGUAGE_CODE %}

{% block extrastyle %}
<!-- Styles -->
<style>
    #chartdiv {
        width: 80%;
        height: 500px;
    }
</style>

<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
{% endblock %}

{% block extrahead %}

<script type="text/javascript">
    function get_api_data(year, base_currency) {
        $.get('/api/angola-estima/summary_budget_per_year_all_country/?year=' + year + '&base_currency=' + base_currency, function (data) {

            $('.year-text').text(year)
            $('.currency-text').text(base_currency)
            //console.table(data);
            chart.data = data;
        });
    }

    $(document).ready(function () {
        //Bind
        $(document).on('change', '#id_year', function () {
            get_api_data($(this).val(), $('#id_base_currency').val());
        });

        //Bind
        $(document).on('change', '#id_base_currency', function () {
            get_api_data($('#id_year').val(), $(this).val());
        });

        //init
        $('#id_year').trigger('change');
        $('#id_base_currency').trigger('change');
    });

    var chart;
    am4core.ready(function () {

        // Themes begin
        am4core.useTheme(am4themes_animated);
        // Themes end

        chart = am4core.create("chartdiv", am4charts.XYChart);
        chart.padding(20, 20, 20, 20);

        chart.numberFormatter.bigNumberPrefixes = [
            { "number": 1e+3, "suffix": "K" },
            { "number": 1e+6, "suffix": "Mi" },
            { "number": 1e+9, "suffix": "Bi" },
            { "number": 1e+12, "suffix": "Tri" },
            { "number": 1e+15, "suffix": "Qua" },
            { "number": 1e+18, "suffix": "E" },
            { "number": 1e+21, "suffix": "Z" },
            { "number": 1e+24, "suffix": "Y" }
        ]

        chart.numberFormatter.numberFormat = "#,#.a";

        var categoryAxis = chart.yAxes.push(new am4charts.CategoryAxis());
        categoryAxis.renderer.grid.template.location = 0;
        categoryAxis.dataFields.category = "country";
        categoryAxis.renderer.minGridDistance = 1;
        categoryAxis.renderer.inversed = true;
        categoryAxis.renderer.grid.template.disabled = true;

        var valueAxis = chart.xAxes.push(new am4charts.ValueAxis());
        valueAxis.min = 0;

        var series = chart.series.push(new am4charts.ColumnSeries());
        series.dataFields.categoryY = "country";
        series.dataFields.valueX = "budget_euro";
        series.tooltipText = "{valueX.value}"
        series.columns.template.strokeOpacity = 0;
        series.columns.template.column.cornerRadiusBottomRight = 5;
        series.columns.template.column.cornerRadiusTopRight = 5;

        var labelBullet = series.bullets.push(new am4charts.LabelBullet())
        labelBullet.label.horizontalCenter = "left";
        labelBullet.label.dx = 10;
        labelBullet.label.text = "{values.valueX.workingValue.formatNumber('#.0as')}";
        labelBullet.label.truncate = false;
        labelBullet.locationX = 1;



        // as by default columns of the same series are of the same color, we add adapter which takes colors from chart.colors color set
        series.columns.template.adapter.add("fill", function (fill, target) {
            return chart.colors.getIndex(target.dataItem.index);
        });

        categoryAxis.sortBySeries = series;

        


    }); // end am4core.ready()
</script>

{% endblock extrahead %}

{% block content %}
<hr>
<div class="row">
    <script type="text/javascript">


    </script>
    <div class="left">

        {{ form }}
    </div>

    <div class="row">
        <h1 class="center">Orçamento Anual Por País - <small class="year-text">20xx</small> <small>em</small> <small
                class="currency-text" style="color: green;"></small></h1>
    </div>
    <br>

    <!-- HTML -->
    <div class="col-3"></div>
    <div class="col-6 chart-wrapper" id="chartdiv"></div>
    <div class="col-3"></div>

</div>
<hr>

{% endblock %}